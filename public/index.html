<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Bot - Panel de Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üì±</div>
                <h1 class="text-2xl font-bold text-gray-800">WhatsApp Bot</h1>
                <p class="text-gray-500">Panel de Control</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Usuario</label>
                    <input type="text" id="username" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="Ingresa tu usuario">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contrase√±a</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="Ingresa tu contrase√±a">
                </div>
                <div id="loginError" class="text-red-500 text-sm text-center hidden"></div>
                <button type="submit" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">Iniciar Sesi√≥n</button>
            </form>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="hidden flex min-h-screen">
        <!-- SIDEBAR -->
        <aside class="sidebar fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-10 flex flex-col">
            <div class="p-6 border-b">
                <div class="flex items-center gap-3">
                    <span class="text-3xl">üì±</span>
                    <div>
                        <h1 class="font-bold text-gray-800">WhatsApp Bot</h1>
                        <p class="text-xs text-gray-500">Panel de Control</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 p-4">
                <ul class="space-y-2">
                    <li>
                        <button id="nav-sessions" onclick="showSection('sessions')" class="sidebar-item active w-full text-left px-4 py-3 rounded-lg flex items-center gap-3">
                            <span>üìã</span><span>Sesiones</span>
                        </button>
                    </li>
                    <li>
                        <button id="nav-monitor" onclick="showSection('monitor')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3">
                            <span>üìä</span><span>Monitor</span>
                        </button>
                    </li>
                    <li>
                        <button id="nav-personal" onclick="showSection('personal')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3">
                            <span>üí¨</span><span>Mensaje Personal</span>
                        </button>
                    </li>
                    <li>
                        <button id="nav-bulk" onclick="showSection('bulk')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3">
                            <span>üì§</span><span>Env√≠o Masivo</span>
                        </button>
                    </li>
                    <li>
                        <button id="nav-analytics" onclick="showSection('analytics')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3">
                            <span>üìà</span><span>Analytics</span>
                        </button>
                    </li>
                    <li>
                        <button id="nav-settings" onclick="showSection('settings')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg flex items-center gap-3">
                            <span>‚öôÔ∏è</span><span>Configuraci√≥n</span>
                        </button>
                    </li>
                </ul>
            </nav>
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t bg-gray-50">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm text-gray-600">‚è±Ô∏è Sesi√≥n:</span>
                    <span id="sessionTimer" class="font-mono text-green-600 font-bold">5:00</span>
                </div>
                <button onclick="logout()" class="w-full bg-red-500 text-white py-2 rounded-lg text-sm hover:bg-red-600 transition-colors">üö™ Cerrar Sesi√≥n</button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 ml-64 p-6">
            <header class="bg-white rounded-lg shadow p-4 mb-6 flex justify-between items-center">
                <div>
                    <h2 id="sectionTitle" class="text-xl font-bold text-gray-800">Sesiones de WhatsApp</h2>
                    <p id="sectionSubtitle" class="text-sm text-gray-500">Gestiona tus conexiones de WhatsApp</p>
                </div>
                <div class="text-right">
                    <div id="activeSessionsCount" class="text-sm text-gray-600 mb-1"></div>
                    <div class="flex items-center gap-2 justify-end">
                        <div id="rotationInfo" class="text-xs text-purple-600 font-medium"></div>
                        <button onclick="rotateSessionManually()" id="rotateBtn" class="bg-purple-500 text-white px-3 py-1 text-xs rounded-lg hover:bg-purple-600 transition-colors flex items-center gap-1" title="Rotar sesi√≥n manualmente">
                            üîÑ Rotar
                        </button>
                    </div>
                </div>
            </header>

            <!-- SECTION: SESSIONS -->
            <section id="section-sessions" class="section-content active">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">‚ûï Crear Nueva Sesi√≥n</h3>
                    <div class="flex gap-4">
                        <input type="text" id="sessionName" placeholder="Nombre de la sesi√≥n (ej: MiEmpresa)" class="flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none">
                        <button onclick="createSession()" id="createSessionBtn" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">Crear Sesi√≥n</button>
                    </div>
                    <p id="createSessionStatus" class="mt-2 text-sm"></p>
                </div>
                <div id="sessionsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center p-8">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-gray-600">Cargando sesiones...</p>
                    </div>
                </div>
            </section>

            <!-- SECTION: PERSONAL MESSAGE -->
            <section id="section-personal" class="section-content">
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">üí¨ Enviar Mensaje Personalizado</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sesiones (selecciona una o varias)</label>
                                <div id="personalSessionCheckboxes" class="border rounded-lg p-3 max-h-32 overflow-y-auto bg-gray-50">
                                    <p class="text-gray-500 text-sm">Cargando sesiones...</p>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero de Tel√©fono</label>
                                <input type="text" id="personalPhone" placeholder="573196319531" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Archivo (opcional)</label>
                                <input type="file" id="personalFile" accept="image/*,video/*,audio/*,.pdf,.doc,.docx" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Mensaje</label>
                                <textarea id="personalMessage" placeholder="Escribe tu mensaje aqu√≠..." class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none h-32"></textarea>
                            </div>
                            <button onclick="sendPersonalMessage()" id="sendPersonalBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-semibold">üì® Enviar Mensaje</button>
                            <div id="personalStatus" class="text-sm"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: BULK SEND -->
            <section id="section-bulk" class="section-content">
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">üì§ Env√≠o Masivo de Mensajes</h3>

                    <!-- Tabs -->
                    <div class="mb-4 border-b">
                        <div class="flex">
                            <button id="tabNumbers" onclick="switchBulkTab('numbers')" class="px-4 py-2 border-b-2 border-purple-500 text-purple-600 font-medium">üì± N√∫meros de Tel√©fono</button>
                            <button id="tabGroups" onclick="switchBulkTab('groups')" class="px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700">üë• Grupos de WhatsApp</button>
                        </div>
                    </div>

                    <!-- Panel Numbers -->
                    <div id="panelNumbers" class="mb-4">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sesiones de WhatsApp (selecciona una o varias)</label>
                            <div id="bulkSessionCheckboxes" class="border rounded-lg p-3 max-h-32 overflow-y-auto bg-gray-50">
                                <p class="text-gray-500 text-sm">Cargando sesiones...</p>
                            </div>
                            <div class="flex gap-2 mt-2">
                                <button onclick="selectAllBulkSessions()" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200">Seleccionar todas</button>
                                <button onclick="deselectAllBulkSessions()" class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded hover:bg-gray-200">Deseleccionar todas</button>
                            </div>
                        </div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lista de N√∫meros (uno por l√≠nea)</label>
                        <textarea id="bulkContacts" placeholder="573196319531
573123456789
573987654321" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none h-32"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Formato: c√≥digo pa√≠s + n√∫mero. Un n√∫mero por l√≠nea. M√°ximo 50.</p>
                    </div>

                    <!-- Panel Groups -->
                    <div id="panelGroups" class="mb-4 hidden">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Seleccionar Sesi√≥n de WhatsApp</label>
                            <select id="groupSessionSelect" onchange="loadGroupsFromSession()" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none bg-white">
                                <option value="">-- Selecciona una sesi√≥n --</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Los grupos se cargar√°n de la sesi√≥n seleccionada</p>
                        </div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Seleccionar Grupos</label>
                        <div id="groupsList" class="border rounded-lg p-3 max-h-48 overflow-y-auto bg-gray-50">
                            <p class="text-gray-500 text-sm">Selecciona una sesi√≥n para ver los grupos</p>
                        </div>
                        <div class="flex gap-2 mt-2">
                            <button onclick="selectAllGroups()" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200">Seleccionar todos</button>
                            <button onclick="deselectAllGroups()" class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded hover:bg-gray-200">Deseleccionar todos</button>
                        </div>
                    </div>

                    <!-- Message and file -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Mensaje</label>
                            <textarea id="bulkMessage" placeholder="Mensaje para env√≠o masivo..." class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none h-24"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Archivo (opcional)</label>
                            <input type="file" id="bulkFileInput" accept="image/*,video/*,audio/*,.pdf,.doc,.docx" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none">
                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Delay (segundos)</label>
                                <input type="number" id="bulkDelay" value="3" min="1" max="10" class="w-20 px-2 py-1 border rounded-lg">
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="flex gap-4 flex-wrap">
                        <button onclick="sendBulkMessages()" id="sendBulkBtn" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">üöÄ Enviar Masivo</button>
                        <button onclick="clearBulkForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">üóëÔ∏è Limpiar</button>
                    </div>

                    <!-- Status -->
                    <div id="bulkStatus" class="mt-4 text-sm"></div>
                    <div id="bulkProgress" class="mt-2 hidden">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div id="bulkProgressBar" class="bg-purple-600 h-2 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                        <p id="bulkProgressText" class="text-xs text-gray-600 mt-1"></p>
                    </div>
                </div>
            </section>

            <!-- SECTION: MONITOR -->
            <section id="section-monitor" class="section-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg shadow-lg p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">üî• Sesi√≥n Activa</h3>
                            <span class="text-2xl">üì±</span>
                        </div>
                        <div id="monitorActiveSession" class="text-3xl font-bold mb-2">-</div>
                        <p class="text-purple-200 text-sm">Enviando mensajes actualmente</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg shadow-lg p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">‚úÖ Mensajes Enviados</h3>
                            <span class="text-2xl">üì®</span>
                        </div>
                        <div id="monitorTotalMessages" class="text-3xl font-bold mb-2">0</div>
                        <p class="text-green-200 text-sm">Total de esta sesi√≥n</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-orange-500 to-amber-600 rounded-lg shadow-lg p-6 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">üîÑ Pr√≥xima Rotaci√≥n</h3>
                            <span class="text-2xl">‚è±Ô∏è</span>
                        </div>
                        <div id="monitorNextRotation" class="text-3xl font-bold mb-2">--:--</div>
                        <p class="text-orange-200 text-sm">Tiempo restante</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">üìä Estad√≠sticas por Sesi√≥n</h3>
                        <button onclick="refreshMonitorStats()" class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-lg text-sm transition-colors">üîÑ Actualizar</button>
                    </div>
                    <div id="monitorSessionStats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <p class="text-gray-500 col-span-full text-center">Cargando estad√≠sticas...</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow mb-6">
                    <div class="border-b border-gray-200">
                        <nav class="flex -mb-px">
                            <button onclick="showMonitorTab('realtime')" id="tab-realtime" class="monitor-tab active px-6 py-3 border-b-2 border-purple-500 text-purple-600 font-medium">
                                üì° Tiempo Real
                            </button>
                            <button onclick="showMonitorTab('history')" id="tab-history" class="monitor-tab px-6 py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium">
                                üìÖ Historial
                            </button>
                        </nav>
                    </div>
                    
                    <div id="monitorTab-realtime" class="p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">üìù Mensajes Recientes</h3>
                            <div class="flex gap-2">
                                <button onclick="toggleMonitorAutoRefresh()" id="monitorAutoRefreshBtn" class="bg-green-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-green-600 transition-colors">‚ñ∂Ô∏è Auto</button>
                                <button onclick="clearMonitorLog()" class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-lg text-sm transition-colors">üóëÔ∏è Limpiar</button>
                            </div>
                        </div>
                        <div id="monitorMessageLog" class="bg-gray-900 rounded-lg p-4 h-80 overflow-y-auto font-mono text-sm">
                            <p class="text-gray-500">Esperando mensajes...</p>
                        </div>
                    </div>
                    
                    <div id="monitorTab-history" class="p-6 hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">üìÖ Historial de Mensajes</h3>
                            <button onclick="loadHistory()" class="bg-purple-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-purple-600 transition-colors">üîÑ Actualizar</button>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="font-semibold text-gray-700 mb-3">üìÜ Por Fecha</h4>
                            <div id="historyByDate" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <p class="text-gray-500 col-span-full text-center">Cargando...</p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-700 mb-3">üì± Por Sesi√≥n</h4>
                            <div id="historyBySession" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <p class="text-gray-500 col-span-full text-center">Cargando...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: ANALYTICS -->
            <section id="section-analytics" class="section-content">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Periodo</label>
                            <select id="analyticsPeriod" class="w-full rounded-lg border-gray-300 shadow-sm p-2.5 border">
                                <option value="day">D√≠a</option>
                                <option value="week">Semana</option>
                                <option value="month">Mes</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </div>
                        
                        <div id="analyticsCustomDateContainer" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Fecha inicio</label>
                            <input type="date" id="analyticsStartDate" class="w-full rounded-lg border-gray-300 shadow-sm p-2.5 border">
                        </div>
                        
                        <div id="analyticsCustomDateContainer2" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Fecha fin</label>
                            <input type="date" id="analyticsEndDate" class="w-full rounded-lg border-gray-300 shadow-sm p-2.5 border">
                        </div>
                        
                        <div id="analyticsRangeContainer">
                            <label class="block text-sm font-medium text-gray-700 mb-1" id="analyticsRangeLabel">Per√≠odo</label>
                            <select id="analyticsRangeSelector" class="w-full rounded-lg border-gray-300 shadow-sm p-2.5 border">
                                <option value="today">Hoy</option>
                                <option value="yesterday">Ayer</option>
                                <option value="7">√öltimos 7 d√≠as</option>
                                <option value="15">√öltimos 15 d√≠as</option>
                                <option value="30">√öltimos 30 d√≠as</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Top N n√∫meros</label>
                            <select id="analyticsTopN" class="w-full rounded-lg border-gray-300 shadow-sm p-2.5 border">
                                <option value="10">Top 10</option>
                                <option value="20">Top 20</option>
                                <option value="50">Top 50</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Acciones</label>
                            <div class="flex gap-2">
                                <button onclick="refreshAnalytics()" class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-colors">üîÑ</button>
                                <button onclick="exportAnalyticsCSV()" class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors">üì•</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                        <div class="text-sm">
                            <span class="font-semibold">Per√≠odo:</span> 
                            <span id="analyticsCurrentPeriodInfo">Hoy</span>
                            <span class="ml-4 text-gray-400">|</span>
                            <span class="ml-4">Estado: <span id="analyticsStatusBadge" class="px-2 py-1 text-xs rounded-full bg-gray-200">Cargando...</span></span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow p-5">
                        <div class="text-3xl font-semibold" id="analytics_kpi_total">‚Äî</div>
                        <div class="text-sm text-gray-500">Total registros</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-5">
                        <div class="text-3xl font-semibold text-green-600" id="analytics_kpi_enviados">‚Äî</div>
                        <div class="text-sm text-gray-500">Enviados</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-5">
                        <div class="text-3xl font-semibold text-red-600" id="analytics_kpi_errores">‚Äî</div>
                        <div class="text-sm text-gray-500">Errores</div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-5">
                        <div class="text-3xl font-semibold text-yellow-600" id="analytics_kpi_cola">‚Äî</div>
                        <div class="text-sm text-gray-500">En cola</div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">Estado de Sesiones</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-sm text-gray-500 mb-1">Sesi√≥n Actual</div>
                            <div class="font-mono text-lg" id="analyticsCurrentSession">‚Äî</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-sm text-gray-500 mb-1">Progreso de Mensajes</div>
                            <div class="font-mono text-lg" id="analyticsSessionProgress">‚Äî</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" id="analyticsProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-sm text-gray-500 mb-1">Sesiones Disponibles</div>
                            <div class="font-mono text-sm" id="analyticsAvailableSessions">‚Äî</div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-6 lg:col-span-2">
                        <h3 class="text-lg font-semibold mb-4">Evoluci√≥n por periodo</h3>
                        <div class="w-full" style="height: 350px;">
                            <canvas id="analyticsTimelineChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Top N n√∫meros</h3>
                        <div class="w-full" style="height: 350px;">
                            <canvas id="analyticsTopChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">Detalle Top N</h3>
                    <div class="overflow-auto">
                        <table class="min-w-full text-sm">
                            <thead class="border-b border-gray-200">
                                <tr class="text-left">
                                    <th class="py-2 pr-4">#</th>
                                    <th class="py-2 pr-4">N√∫mero</th>
                                    <th class="py-2 pr-4">Total</th>
                                    <th class="py-2 pr-4">Enviados</th>
                                    <th class="py-2 pr-4">Errores</th>
                                    <th class="py-2 pr-4">En cola</th>
                                </tr>
                            </thead>
                            <tbody id="analyticsTopTableBody">
                                <tr>
                                    <td colspan="6" class="py-4 text-center text-gray-500">Cargando datos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="text-xs text-gray-500 mt-6 space-y-1">
                    <div>DB size (MB): <span id="analyticsDbSize">‚Äî</span></div>
                    <div>Estados en DB: <span id="analyticsDbByStatus">‚Äî</span></div>
                    <div>√öltima actualizaci√≥n: <span id="analyticsLastUpdate">‚Äî</span></div>
                </div>
            </section>

            <!-- SETTINGS SECTION -->
            <section id="settingsSection" class="hidden space-y-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">Configuraci√≥n de Env√≠o por Lotes (Batch)</h3>
                    <p class="text-gray-600 mb-6">
                        Para evitar baneos, los mensajes se agrupan y se env√≠an cada cierto tiempo.
                        Aqu√≠ puedes configurar el intervalo de env√≠o.
                    </p>
                    
                    <div class="max-w-md">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Intervalo de env√≠o (minutos)
                        </label>
                        <div class="flex items-center gap-4">
                            <input type="range" id="batchIntervalRange" min="1" max="10" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="batchIntervalValue" class="text-2xl font-bold text-green-600 w-12 text-center">3</span>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>1 min (R√°pido)</span>
                            <span>10 min (Seguro)</span>
                        </div>
                        
                        <button onclick="saveBatchSettings()" class="mt-6 bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors w-full">
                            Guardar Configuraci√≥n
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">Estado de la Cola</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                            <div class="text-sm text-blue-600 mb-1">Mensajes en Cola</div>
                            <div id="queueSize" class="text-2xl font-bold text-blue-800">0</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                            <div class="text-sm text-purple-600 mb-1">N√∫meros Pendientes</div>
                            <div id="pendingNumbers" class="text-2xl font-bold text-purple-800">0</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                            <div class="text-sm text-green-600 mb-1">Intervalo Actual</div>
                            <div id="currentInterval" class="text-2xl font-bold text-green-800">3 min</div>
                        </div>
                    </div>
                    <button onclick="refreshBatchStatus()" class="mt-4 text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1">
                        üîÑ Actualizar estado
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts externos -->
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script src="js/analytics.js"></script>
</body>
</html>
